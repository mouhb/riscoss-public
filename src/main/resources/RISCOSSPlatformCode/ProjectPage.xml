<?xml version='1.0' encoding='UTF-8'?>
<xwikidoc version="1.1">
  <web>RISCOSSPlatformCode</web>
  <name>ProjectPage</name>
  <language/>
  <defaultLanguage>en</defaultLanguage>
  <translation>0</translation>
  <creator>xwiki:XWiki.superadmin</creator>
  <creationDate>1435675874000</creationDate>
  <parent>Main.WebHome</parent>
  <author>xwiki:XWiki.superadmin</author>
  <contentAuthor>xwiki:XWiki.superadmin</contentAuthor>
  <date>1443437357000</date>
  <contentUpdateDate>1443437324000</contentUpdateDate>
  <version>2.411</version>
  <title>$!xwiki.getDocument($request.project).title project page</title>
  <comment/>
  <minorEdit>true</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content>{{include document="RISCOSSPlatformCode.githubProjectMacros" /}}&#xd;
&#xd;
{{velocity}}&#xd;
## This page shows the risk analysis reuslts of a given project&#xd;
&#xd;
## Globals&#xd;
#set($projectDocRef = $request.project)&#xd;
#set($userName = $xwiki.getDocument($xcontext.user).name)&#xd;
#if ("$!projectDocRef" != '' &amp;&amp; $xwiki.exists($projectDocRef))&#xd;
   ## Get associated sessions&#xd;
   #set($query = "from doc.object(RISCOSSPlatformRiskAnalysisManagerCode.RiskEvaluationClass) as session where session.entity=:projectDocRef and session.riskConfiguration='RISCOSSPlatformRiskConfigurations.BasicRiskConfiguration' and doc.space like 'RISCOSSPlatformRiskAnalysisSessions%'")&#xd;
   #set($riskAnlysisSessions = $services.query.xwql($query).bindValue("projectDocRef","${projectDocRef}").setLimit(1).execute())&#xd;
   #if ($riskAnlysisSessions.size() > 0)&#xd;
      #set($RiskEvaluationViewSheet_analisysSessionDoc = $xwiki.getDocument($riskAnlysisSessions[0]))&#xd;
      ## Calculate project score&#xd;
      #getProjectScore($RiskEvaluationViewSheet_analisysSessionDoc)&#xd;
      #set($projectLink = $doc.getExternalURL("view","project=${escapetool.url($projectDocRef)}"))&#xd;
      ## Calculate the project ranking value&#xd;
      #calculateTopTenProjectsAverageScore()&#xd;
      #set($projectRanking = $mathtool.div($mathtool.mul($projectScore,100),$topTenProjectsScoresAverage))&#xd;
      #set($projectRanking = $mathtool.roundTo(2,$projectRanking))&#xd;
      #set($projectRanking = $mathtool.toInteger($projectRanking))&#xd;
      #set($mod = $mathtool.mod($projectRanking, 10))&#xd;
      #if($mod > 5)&#xd;
            #set($projectRanking = $mathtool.add($projectRanking, $mathtool.sub(10, $mod)))&#xd;
      #else&#xd;
         #set($projectRanking = $mathtool.sub($projectRanking, $mod))&#xd;
      #end&#xd;
      #if($projectRanking >= 50)&#xd;
         #if($projectRanking >= 100)&#xd;
            #set($projectRanking = 1)&#xd;
         #else&#xd;
            #set($projectRanking = $mathtool.sub(100, $projectRanking))&#xd;
         #end&#xd;
         #set($projectRanking = "This project is in the top &lt;strong>${projectRanking}%&lt;/strong> of the best projects")   &#xd;
      #else&#xd;
         ##set($projectRanking = $mathtool.sub(100, $projectRanking))&#xd;
         #set($projectRanking = "This project is in the bottom &lt;strong>${projectRanking}%&lt;/strong> of the best projects")  &#xd;
      #end&#xd;
      ## Project information&#xd;
      #set($projectDoc = $xwiki.getDocument($projectDocRef))&#xd;
      #set($obj = $projectDoc.getObject("RISCOSSPlatformLayers.OSSComponent"))&#xd;
      {{html}}&#xd;
      &lt;table class="analysis-res-table">&#xd;
      &lt;tr>&lt;th>Project name&lt;/th>&lt;td>$!obj.getProperty("name").value&lt;/td>&lt;/tr>&#xd;
      &lt;tr>&lt;th>Description&lt;/th>&lt;td>$!obj.getProperty("description").value&lt;/td>&lt;/tr>&#xd;
      &lt;tr>&lt;th>Web site&lt;/th>&lt;td>&lt;a href="$obj.getProperty("website").value">$obj.getProperty("website").value&lt;/a>&lt;/td>&lt;/tr>&#xd;
      &lt;/table>&#xd;
      {{/html}}&#xd;
&#xd;
      ## Ranking/Twitter btn&#xd;
      {{html}}&#xd;
      &lt;h2 id="projectRanking">$services.localization.render("riscossPlatform.githubprojects.projectpage.projectscore") : &lt;strong>$projectScore&lt;/strong> - $projectRanking&lt;/h2>&#xd;
      {{/html}}&#xd;
&#xd;
      {{info}}&#xd;
      The total project ranking is derived from the project score that is calculated from the components of the risk analysis (Obsolescence Risk, Bug Risk, Analysability Risk, Maintenance Risk).&#xd;
      The project ranking represents the percentage of the project's score compared to the top ten projects average score.&#xd;
      The higher the score the better the project is ranked.&#xd;
      {{/info}}&#xd;
&#xd;
      {{html}}&#xd;
      &lt;div class="tweetScore">&lt;div class="tweetLabel">$services.localization.render("riscossPlatform.githubprojects.projectpage.tweetthisscore")&lt;/div>&lt;div class="tweetBtn">&lt;a href="https://twitter.com/share" class="twitter-share-button" data-url="" data-text="${projectLink} scored ${projectScore} on #riscoss" data-size="large" data-count="none">Tweet&lt;/a>&#xd;
      &lt;script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');&lt;/script>&lt;/div>&#xd;
      &lt;/div>&#xd;
      &lt;div style="clear:both;">&lt;/div>&#xd;
      {{/html}}&#xd;
      &#xd;
      ## Display analysis results&#xd;
      = Basic Risk Analysis =&#xd;
      A basic risk analysis is an analysis of a project without any context information about how it will be used, this can provide hints about possible areas of concern but is less thorough than an Advanced Risk Analysis based on a project //and// a use case.&#xd;
&#xd;
      #set($displayInProjectPage = "true")&#xd;
      {{include reference="RISCOSSPlatformRiskAnalysisManagerCode.RiskEvaluationViewSheet" /}}&#xd;
   #else&#xd;
      {{info}}&#xd;
         $services.localization.render("riscossPlatform.githubprojects.projectpage.analysisinprogress")&#xd;
      {{/info}}&#xd;
   #end&#xd;
#else&#xd;
{{warning}}&#xd;
$services.localization.render("riscossPlatform.githubprojects.projectpage.analysisinprogress")&#xd;
{{/warning}}&#xd;
#end&#xd;
{{/velocity}}</content>
  <object>
    <name>RISCOSSPlatformCode.ProjectPage</name>
    <number>0</number>
    <className>XWiki.StyleSheetExtension</className>
    <guid>a81433ee-356b-4bd0-8248-60b8ba438074</guid>
    <class>
      <name>XWiki.StyleSheetExtension</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <cache>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>cache</name>
        <number>5</number>
        <prettyName>Caching policy</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>long|short|default|forbid</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </cache>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>2</number>
        <prettyName>Code</prettyName>
        <rows>20</rows>
        <size>50</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <parse>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>parse</name>
        <number>4</number>
        <prettyName>Parse content</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </parse>
      <use>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>use</name>
        <number>3</number>
        <prettyName>Use this extension</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators> ,|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </use>
    </class>
    <property>
      <cache>long</cache>
    </property>
    <property>
      <code>.tweetScore{&#xd;
   margin-top: 20px;&#xd;
}&#xd;
.tweetScore .tweetLabel, .tweetScore .tweetBtn{&#xd;
   float:left;&#xd;
}&#xd;
.tweetLabel{&#xd;
   padding-top: 2px;&#xd;
   padding-right: 5px;&#xd;
   font-size: 1.5em;&#xd;
}&#xd;
#projectRanking{&#xd;
   text-align: center;&#xd;
   border: 0;&#xd;
   background: #F3F3F3;&#xd;
   padding: 1em;&#xd;
   margin: 0;&#xd;
}</code>
    </property>
    <property>
      <name></name>
    </property>
    <property>
      <parse/>
    </property>
    <property>
      <use>currentPage</use>
    </property>
  </object>
</xwikidoc>